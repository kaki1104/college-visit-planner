#!/usr/bin/python3

import requests
import json
import time

# linkpreview api determines rate not by account, but through address
api_keys = ["52e0e0833bcbb8e49f79d81d75fa36d9", "7a2e6121140a43d13d4697bd430bed8a", "0a6e24d188c12849e30ea4481389da2b"]

api_key = "key=" + api_keys[0] + "&q=https://"

university_domain_existing = open("university-domain-existing.txt", 'r')
university_preview = open("university-preview.txt", 'a')

# Only use when creating the file for the first time
# university_preview.write("Name,Title,Description,Image,Url\n")

count = 0
start = 818

for line in university_domain_existing:
	if (count >= start) and (count < start + 60):
		name = line[:line.find('(')-1]
		domain = line[line.find('(')+1:line.find(')')]

		data = api_key + domain
		response = requests.post("https://api.linkpreview.net", data=data)
		preview = response.json()

		title = preview["title"]
		description = preview["description"]
		image = preview["image"]
		url = preview["url"]

		university_preview.write(name + ',' + title + ',' + description + ',' + image + ',' + url + "\n")
		print(str(count) + ' ' + name + ',' + title + ',' + description + ',' + image + ',' + url + "\n")
		time.sleep(2)
	count += 1

university_domain_existing.close()
university_preview.close()